<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://unpkg.com/react@16.3.0-alpha.1/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@16.3.0-alpha.1/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
</head>
<body >
  <div id="app">

  </div>


<!-- <script src="index.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.5/redux.js"></script>
<script >
const ADD_TODO = 'ADD_TODO';
const REMOVE_TODO = 'REMOVE_TODO';
const ADD_GOAL = 'ADD_GOAL';
const REMOVE_GOAL = 'REMOVE_GOAL';

const todos = (state = [], event) => {
  switch (event.type) {
    case ADD_TODO:
      return state.concat(event.data);
    case REMOVE_TODO:
      return state.filter((item) => item.name !== event.data.name);
    default:
      return state;
  }
};

const goals = (state = [], event) => {
  switch (event.type) {
    case ADD_GOAL:
      return state.concat(event.data);
    case REMOVE_GOAL:
      return state.filter((item) => item.name !== event.data.name);
    default:
      return state;
  }
};

// const indexReducer = (state = {}, event) => ({
//   todos: todoReducer(state.todos, event),
//   goals: goalReducer(state.goals, event),
// });

const checker = (store) => (next) => (action) => {
        if(action.type === ADD_TODO
        && action.data.name.toLowerCase().includes('abuse')){
        return alert("failed");
        }else{
          next(action)
        }
      }

 const logger = (store) => (next) => (action) => {
   console.table(action)
      console.log(action)
      console.log(store.getState());
  
   next(action)
 }
   
const store = Redux.createStore(Redux.combineReducers({
  todos, 
  goals,
}), Redux.applyMiddleware(checker, logger));
console.log(store.getState());


const addTodoAction = (name) => ({
  type: 'ADD_TODO',
  data: {
    name,
  },
});

const removeTodoAction = (name) => ({
  type: 'REMOVE_TODO',
  data: {
    name,
  },
});

const addGoalAction = (name) => ({
  type: 'ADD_GOAL',
  data: {
    name,
  },
});


const removeGoalAction = (name) => ({
  type: 'REMOVE_GOAL',
  data: {
    name,
  },
});

// store.dispatch(addTodoAction('Nitesh'));
// store.dispatch(addTodoAction('Lin'));
// store.dispatch(addGoalAction('Akhil'));

store.subscribe(() => {
  document.getElementById('todos').innerHTML = '';
  const { goals, todos }= store.getState();
  todos.forEach((todo) => {
    addTodotoDom(todo.name)
  })
})

</script>
<script>

  


  function addTodo(event){
    event.preventDefault();
    const value = document.getElementById('todo_input').value;
    store.dispatch(addTodoAction(value))

    // addTodotoDom(value);
  }

  document.getElementById("todo_button")
          .addEventListener("click", addTodo);
  
  function addTodotoDom(todo){
    const node = document.createElement('li');
    const text = document.createTextNode(todo);
    node.appendChild(text);

    document.getElementById("todos")
      .appendChild(node);

  }

</script>

<script type="text/babel">
  console.log(React)
  class App extends React.Component{

    state = {
      value : '',
      todos: []
    }
      
    handleChange = (event) => {
      const value = event.target.value;

      this.setState({
        value,
      })
    }

    handleSubmit = (event) => {
      event.preventDefault();
      store.dispatch(addTodoAction(this.state.value));
      const newState = store.getState();
      console.log(newState)
      this.setState({
        todos: newState.todos
      })
    }

    render(){
      return (
        <div>
        <h2>Todos</h2>
        <form className='.todo' onSubmit={this.handleSubmit}>
          <input type="text" name="add-todo" id="todo_input" onChange={this.handleChange} value={this.state.value} />
          <button id="todo_button ">add todo</button>
        </form>
        <ul id="todos">
          
        </ul>

        <hr />

        <h2>Goals</h2>
        </div>
      )
    }
  }

  ReactDOM.render(<App />, document.getElementById("app"))
</script>
</body>
</html>